<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aimsphm.nuclear.common.mapper.SysLogMapper">
    <resultMap id="SysLogMap" type="com.aimsphm.nuclear.common.entity.SysLog">
        <result column="id" property="id"/>
        <result column="user_name" property="userName"/>
        <result column="operation" property="operation"/>
        <result column="method_type" property="methodType"/>
        <result column="method_cn_type" property="methodCnType"/>
        <result column="method" property="method"/>
        <result column="params" property="params"/>
        <result column="time" property="time"/>
        <result column="server_ip" property="serverIp"/>
        <result column="ip" property="ip"/>
        <result column="url" property="url"/>
        <result column="create_by" property="createBy"/>
        <result column="last_update_by" property="lastUpdateBy"/>
        <result column="last_update_on" property="lastUpdateOn"/>
        <result column="create_on" property="createOn"/>
        <result column="delimit" property="delimit"/>
    </resultMap>

    <resultMap id="SysLogReturnMap" type="com.aimsphm.nuclear.common.pojo.SysLogResult">
        <result column="id" property="id"/>
        <result column="user_name" property="userName"/>
        <result column="operation" property="operation"/>
        <result column="method_type" property="methodType"/>
        <result column="method_cn_type" property="methodCnType"/>
        <result column="method" property="method"/>
        <result column="params" property="params"/>
        <result column="time" property="time"/>
        <result column="server_ip" property="serverIp"/>
        <result column="ip" property="ip"/>
        <result column="url" property="url"/>
    </resultMap>
    <select id="getSysLogListByInfo" resultMap="SysLogReturnMap">
        select id, user_name, operation, method, method_type, params, ip, server_ip, url, time, method_cn_type from sys_log
        <trim prefix="WHERE" prefixOverrides="AND |OR ">
            <if test="sysLogQueryBo.userName != null">
                AND user_name = #{sysLogQueryBo.userName,jdbcType=VARCHAR}
            </if>
            <if test="sysLogQueryBo.methodType != null">
                AND method_type = #{sysLogQueryBo.methodType,jdbcType=VARCHAR}
            </if>
            <if test="sysLogQueryBo.methodCnType != null">
                AND method_cn_type = #{sysLogQueryBo.methodCnType,jdbcType=VARCHAR}
            </if>
            <if test="sysLogQueryBo.keyword != null">
                AND (operation LIKE concat('%', #{sysLogQueryBo.keyword,jdbcType=VARCHAR} ,'%')
                OR url LIKE concat('%', #{sysLogQueryBo.keyword,jdbcType=VARCHAR} ,'%')
                OR method  LIKE concat('%', #{sysLogQueryBo.keyword,jdbcType=VARCHAR} ,'%'))
            </if>
            <if test="sysLogQueryBo.startTime != null">
                AND time &gt;= #{sysLogQueryBo.startTime, jdbcType=TIMESTAMP}
            </if>
            <if test="sysLogQueryBo.endTime != null">
                AND time &lt;= #{sysLogQueryBo.endTime, jdbcType=TIMESTAMP}
            </if>
            <if test="1 == 1">
                AND delimit = 0
            </if>
        </trim>
        ORDER BY time DESC
    </select>
</mapper>